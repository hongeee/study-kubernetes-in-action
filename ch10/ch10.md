# 10장 스테이트풀셋: 복제된 스테이트풀 애플리케이션 배포하기

## 10.1 스테이트풀 파드 복제하기

- 클레임에 대한 참조가 있는 파드 템플릿으로 생성된 여러 개의 파드 레플리카는 각 레플리카가 별도의 퍼시스턴트볼륨클레임을 사용할 수 없음


### 10.1.1 개별 스토리지를 갖는 레플리카 여러 개 실행

- 레플리카셋은 동일한 파드의 복제본을 생성하므로 개별 스토리지 볼륨을 사용하는 파드를 생성할 수 없음

#### 수동으로 파드 생성하기

- 파드를 수동으로 생성해 각 파드가 다른 퍼시스턴트볼륨클레임을 갖게 함
- 파드가 레플리카셋에 의해 관리되지 않으므로 수동으로 관리해야 함

#### 파드 인스턴스별로 하나의 레플리카셋 사용하기

- 파드를 직접 생성하는 대신 여러 개의 레플리카셋 생성
- 레플리카셋의 의도된 레플리카 수를 하나로 설정해 파드별로 하나의 레플리카셋이 되고 각 레플리카셋의 파드 템플릿은 전용 퍼시스턴트볼륨클레임을 참조함
- 스케일링이 불가능하며, 추가 레플리카셋을 생성해야 함

#### 동일 볼륨을 여러 개 디렉터리로 사용하기

- 모든 파드가 동일한 퍼시스턴트볼륨을 사용하지만 각 파드의 볼륨 내부에서 별도의 파일 디렉터리를 갖게 설정
- 각 인스턴스가 생성되는 시점에 다른 인스턴스가 사용하지 않는 데이터 디렉터리를 자동으로 선택하도록 할 수 있으나, 인스턴스 간 조정이 필요하고 공유 스토리지 볼륨에 병목 현상 발생

### 10.1.2 각 파드에 안정적인 아이덴티티 제공하기

- 파드가 재스케줄링되고 새로운 파드는 새로운 호스트 이름과 IP 주소를 할당받으므로, 구성 멤버가 재스케줄링될 때마다 모든 애플리케이션 클러스터가 재구성돼야 함

#### 각 파드 인스턴스별 전용 서비스 사용하기

- 각 개별 멤버에게 전용 쿠버네티스 서비스를 생성해 안정적인 네트워크 주소를 제공
- 각 멤버를 파드 IP가 아닌 서비스 IP를 통해 가리킬 수 있음
- 개별 파드는 자신이 어떤 서비스를 통해 노출되는지 알 수 없으므로 다른 파드에 자신을 등록할 수 없음

## 10.2 스테이트풀셋 이해하기

- 애플리케이션의 인스턴스가 각각 안정적인 이름과 상태를 가지며 개별적으로 취급돼야 하는 애플리케이션에 알맞게 만들어진 리소스

### 10.2.1 스테이트풀셋과 레플리카셋 비교하기

#### 애완동물과 가축 비유로 스테이트풀 파드 이해하기

- 스테이트리스 애플리케이션은 인스턴스가 죽더라도 새로운 인스턴스를 만들 수 있고, 차이가 없기 때문에 문제가 되지 않음(가축)
- 스테이트풀 애플리케이션은 인스턴스가 죽게 되면 새 인스턴스가 이전 인스턴스와 완전히 같은 상태와 아이덴티티를 가져야 함(애완동물)

#### 스테이트풀셋을 레플리카셋 혹은 레플리케이션컨트롤러와 비교하기